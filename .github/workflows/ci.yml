name: CI - Exercice_4

on:
  push:
    branches: [ deploy ]
  pull_request:
    branches: [ deploy ]

jobs:
  test:
    runs-on: ubuntu-latest

    steps:
      - name: ðŸ“¥ Cloner le dÃ©pÃ´t
        uses: actions/checkout@v3

      - name: ðŸŸ¢ Installer Node.js
        uses: actions/setup-node@v3
        with:
          node-version: 18

      - name: ðŸ“¦ Installer les dÃ©pendances de Exercice_4
        working-directory: ./Exercice_4
        run: npm install

      - name: ðŸ§ª Lancer tous les tests
        working-directory: ./Exercice_4
        run: npm run test:all

      - name: ðŸ“Š GÃ©nÃ©rer la couverture de test
        working-directory: ./Exercice_4
        run: npm run test:couverture

      - name: âœ… VÃ©rifier que la couverture â‰¥ 80 %
        working-directory: ./Exercice_4
        run: |
          COVERAGE=$(node -e "console.log(require('./coverage/coverage-summary.json').total.lines.pct)")
          echo "Couverture actuelle : $COVERAGE %"
          if (( $(echo "$COVERAGE < 80" | bc -l) )); then
            echo "âŒ Ã‰chec : couverture < 80 %"
            exit 1
          else
            echo "âœ… Couverture suffisante"
          fi

      - name: ðŸ“ Sauvegarder le rapport de couverture
        uses: actions/upload-artifact@v3
        with:
          name: couverture
          path: Exercice_4/coverage/
